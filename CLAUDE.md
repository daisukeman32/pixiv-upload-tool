# プロジェクト名: Pixiv投稿準備ツール (pixivoon v3.0)

## 概要
複数の画像を一括で読み込み、顔検出による自動クロップと連番リネームを行い、Pixiv投稿用のファイルセットをZIPで出力するWebツール。

## 解決する課題
毎日10枚の画像をPixivに投稿する際、1枚ずつクロップ・リネームする作業が大きな負担になっている。この繰り返し作業を自動化し、「画像を入れてボタンを押すだけ」で投稿準備を完了させたい。

## ターゲットユーザー
自分専用（Daisuke）

---

## 技術スタック

- フロントエンド: HTML / CSS / JavaScript（単一ファイル構成）
- ホスティング: GitHub + Netlify
- データベース: 不要
- 外部ライブラリ:
  - face-api.js（顔検出・目の位置特定）
  - JSZip（ZIP出力）

---

## 機能一覧

### 実装済み機能
- [x] 画像の一括読み込み（ドラッグ＆ドロップ対応）
- [x] 顔検出（SSD MobileNet + 68点ランドマーク + TinyFaceDetector 3段階フォールバック）
- [x] 下唇基準のスクエア自動クロップ
- [x] 元画像はリサイズせずそのまま保持
- [x] 連番リネーム（nnA/nnB/nnC 形式）
- [x] JPG形式で出力
- [x] ZIPファイルで一括ダウンロード
- [x] ダーク/ライトモード切替（右上トグル）
- [x] 処理中のプログレス表示
- [x] 処理結果のプレビュー表示
- [x] localStorage使用履歴（「済」マーク + ランダム除外）
- [x] モザイク/ガウスぼかしブラシツール
- [x] 出力日付の手動設定（未来日付対応）
- [x] Step 2 での画像削除（削除→済履歴に自動追加）
- [x] 複数日分割出力（1日の枚数 × 分割日数 = 合計）
- [x] 日付分割プレビュー + ドラッグ&ドロップ調整

### 未実装
- [ ] 顔検出失敗時の手動クロップ位置調整
- [ ] Netlifyデプロイ

---

## ワークフロー

```
【入力】
10枚の画像をドラッグ＆ドロップ
    ↓
【処理】
1. 各画像で顔検出を実行
2. 目の位置を基準に、目から下を1000×1000pxでクロップ
3. 元画像はそのまま保持（リサイズなし）
4. 連番を付与
    ↓
【出力】
pixiv_upload_YYYYMMDD.zip
├── 01_crop.jpg    ← 1枚目のクロップ（サムネ用）
├── 02_full.jpg    ← 1枚目の元画像（本体用）
├── 11_crop.jpg    ← 2枚目のクロップ
├── 12_full.jpg    ← 2枚目の元画像
├── 21_crop.jpg
├── 22_full.jpg
...
└── 91_crop.jpg, 92_full.jpg ← 10枚目
```

---

## デザイン仕様

### 配色
- ライトモード: 背景 #FFFFFF / 文字 #000000
- ダークモード: 背景 #0A0A0A / 文字 #FFFFFF
- 警告・注意: #CC0000（赤）
- ボーダー・区切り線: #E0E0E0（ライト時）/ #333333（ダーク時）

### アイコン
- 可愛いアイコンは使用しない
- 白黒のピクトグラム（シンプルな線画アイコン）のみ使用
- 例：アップロードアイコン、ダウンロードアイコン、設定アイコン等

### フォント
- 英字: Inter
- 日本語: Noto Sans JP
- ウェイト: 400（通常）/ 600（強調）

### レイアウト
```
┌─────────────────────────────────────────────┐
│ [ロゴ/タイトル]              [🌙/☀️ トグル] │
├─────────────────────────────────────────────┤
│                                             │
│   ┌─────────────────────────────────────┐   │
│   │                                     │   │
│   │    ここに画像をドラッグ＆ドロップ     │   │
│   │         または クリックして選択       │   │
│   │                                     │   │
│   └─────────────────────────────────────┘   │
│                                             │
│   読み込んだ画像: 0/10枚                    │
│                                             │
│   ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐        │
│   │ IMG │ │ IMG │ │ IMG │ │ ... │        │
│   └─────┘ └─────┘ └─────┘ └─────┘        │
│                                             │
│           [ ● 処理を実行 ]                  │
│                                             │
│   ※顔が検出できない画像はスキップされます     │
│                                             │
└─────────────────────────────────────────────┘
```

### UIコンポーネント
- ドロップエリア: 点線ボーダー、ホバー時にボーダー色変化
- ボタン: 角丸なし（または極小の角丸2px）、塗りつぶし背景
- サムネイル: 正方形、小さめ表示（80×80px程度）
- 注意書き: 赤字（#CC0000）で表示

---

## ファイル構成

```
pixiv-upload-tool/
├── index.html      # メインHTML
├── style.css       # スタイル
├── script.js       # メインロジック
├── CLAUDE.md       # この設計書
└── README.md       # GitHub用説明
```

※face-api.jsとJSZipはCDNから読み込み

---

## 技術詳細

### 顔検出の仕様
- face-api.jsのTinyFaceDetectorを使用（軽量・高速）
- 検出した顔のlandmarks（68点）から目の位置を取得
- 目の中心Y座標を基準に、そこから下方向に1000pxをクロップ
- 横位置は顔の中心を基準に左右500pxずつ

### クロップのロジック
```
目のY座標 = (左目Y + 右目Y) / 2
顔の中心X = (左目X + 右目X) / 2

クロップ範囲:
  top = 目のY座標
  left = 顔の中心X - 500
  width = 1000
  height = 1000
```

### 画像が小さい場合の処理
- 元画像が1000px未満の場合は、取得できる最大サイズでクロップ
- 警告メッセージを表示

---

## 開発の進め方

1. **MVP（最小構成）**
   - 画像読み込み（ドラッグ＆ドロップ）
   - 顔検出による自動クロップ
   - 連番リネーム
   - ZIPダウンロード

2. **デザイン適用**
   - ダーク/ライトモード
   - レイアウト調整

3. **改善**
   - エラーハンドリング強化
   - 顔検出失敗時の対応

4. **デプロイ**
   - GitHubにプッシュ
   - Netlifyに接続

---

## 備考・注意点

### 顔検出の限界
- 横顔、下向き、複数人の画像では検出精度が落ちる可能性あり
- 検出できなかった画像はスキップし、ユーザーに通知する

### ブラウザ制限
- 10枚程度なら問題なく処理可能
- 画像サイズが極端に大きい場合（4000px超）は処理が遅くなる可能性

### プライバシー
- すべての処理はブラウザ内で完結（サーバーに画像は送信されない）
- ローカル処理のため安心して使用可能
